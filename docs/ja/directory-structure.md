# ディレクトリ構成

Plan Stack の推奨ディレクトリ構成です。

## 概要

```
your-project/
├── docs/
│   ├── plans/                # 実装計画書
│   │   ├── completed/        # アーカイブ済みの計画書
│   │   └── (進行中の計画書)
│   │
│   ├── architecture/         # 設計・アーキテクチャドキュメント
│   │   ├── auth/
│   │   ├── billing/
│   │   └── ...
│   │
│   ├── features/             # 機能ドキュメント
│   │   ├── users/
│   │   ├── orders/
│   │   └── ...
│   │
│   ├── guides/               # 開発者ガイド・ハウツー
│   │
│   └── templates/            # 計画書・レビューテンプレート
│
├── src/                      # ソースコード
└── ...
```

---

## ディレクトリの役割

### `plans/` - 実装計画書

コードベースに変更を加える前に作成する実装計画書を保存します。

| 場所 | 目的 |
|----------|---------|
| `plans/`（ルート） | 進行中の計画書 |
| `plans/completed/` | アーカイブ済みの計画書 |

**ワークフロー：**
1. 実装前に `plans/` に計画ファイルを作成
2. 作業開始前に人間の承認を得る
3. 承認された計画に従って実装
4. 完了後に `plans/completed/` に移動

**ファイル命名規則：**

```
YYYYMMDD_feature_name.md
```

- 日付プレフィックスで時系列ソートが可能（Rails のマイグレーションと同様）
- 機能名には `snake_case` を使用
- 簡潔かつ説明的な名前（2〜4語）

**良い例：**
- `20250115_user_authentication.md`
- `20250120_payment_integration.md`
- `20250201_api_rate_limiting.md`
- `20250215_order_csv_export.md`

**避けるべき例：**
- 曖昧すぎる: `20250115_fix.md`, `20250115_update.md`
- 長すぎる: `20250115_add_user_authentication_with_oauth_and_jwt.md`
- コンテキストなし: `20250115_api.md`

### `architecture/` - 設計・アーキテクチャ

システム設計、処理フロー、アーキテクチャ決定に関するドキュメントを保存します。

**含めるもの：**
- 処理フローの説明
- 設計決定とその根拠
- 技術的負債と既知の問題

**ドメインで整理：**
- `architecture/auth/` - 認証・認可
- `architecture/billing/` - 請求・決済
- `architecture/api/` - API 設計
- 必要に応じてサブディレクトリを作成

### `features/` - 機能ドキュメント

各機能の仕様、テーブル構成、API エンドポイントを保存します。

**含めるもの：**
- 機能概要と仕様
- 関連テーブル/モデルの説明
- API エンドポイント仕様
- CLI/タスクの使用方法

**ドメインで整理：**

ドメインはビジネスコンテキストのクラスタであり、テーブルプレフィックスによる機械的なグルーピングではありません。関連する機能は各ドメイン内にまとめます。

構成例：
```
features/
├── users/              # ユーザー管理
│   ├── registration.md
│   ├── authentication.md
│   └── profiles.md
│
├── orders/             # 注文管理
│   ├── checkout.md
│   ├── fulfillment.md
│   └── refunds.md
│
├── subscriptions/      # サブスクリプション管理
│   ├── plans.md
│   ├── billing.md
│   └── cancellation.md
│
└── ...
```

**大規模ドメイン：**

大規模なドメインでは、ビジネスフローに基づいてサブディレクトリを作成します：

```
features/orders/
├── checkout/           # チェックアウトフロー
│   └── (カート → 決済 → 確認)
│
├── fulfillment/        # フルフィルメントフロー
│   └── (ピッキング → 出荷 → 配送)
│
├── returns/            # 返品フロー
│   └── (申請 → 承認 → 返金)
│
└── ...
```

ドキュメントの必要性に応じてサブディレクトリを作成してください。

### `guides/` - 開発者ガイド

開発者向けのガイドとハウツードキュメントを保存します。

**含めるもの：**
- 環境構築手順
- 認証/API キーの設定
- ツール使用ガイド
- オンボーディングドキュメント

### `templates/` - テンプレート

計画書とレビューのテンプレートを保存します。

- `plan-template.md` - 新しい計画書作成用テンプレート
- `review-template.md` - レビュー実施用テンプレート

---

## ドキュメントガイドライン

### ファイル形式
- Markdown（`.md`）を使用

### 機能ドキュメントの推奨構成
```markdown
# タイトル

## 概要
このドキュメントの内容の簡単な説明。

## 詳細
メインコンテンツ。

## 関連ファイル
関連するコードファイルへの参照。
```

### 実装計画書の構成
```markdown
# 機能名 - 実装計画書

## タスク概要
何をなぜ行うか。

## 調査結果
- 関連するモデル/コンポーネント
- 既存の処理フロー
- 依存関係

## 実装アプローチ
選択したアプローチとその根拠。

## 変更するファイル
変更するファイルのリスト。

## 考慮事項
- セキュリティへの影響
- パフォーマンスへの影響
- 後方互換性
```

---

## プロモーション基準

ほとんどの計画書は `completed/` に留まります。重要なものだけを昇格させてください。

| 昇格先 | 基準 |
|-------------|----------|
| `architecture/` | 3つ以上の機能に影響するか、システム境界を定義する |
| `features/` | 複数の将来の計画で参照される |

**例：**
- 「ユーザーログアウト追加」の計画書 → `completed/` に留まる
- 認証アーキテクチャを確立した計画書 → `architecture/auth/` に昇格

過度に整理しないでください。プロモーションは任意であり、必須ではありません。

---

## 新しいディレクトリの追加

新しいドメインや機能が出現したら、適切な親ディレクトリの下にサブディレクトリを作成します。

```bash
# 新しい機能ドメインを追加
mkdir -p docs/features/new_domain/

# 新しいアーキテクチャカテゴリを追加
mkdir -p docs/architecture/new_category/

# 構造は柔軟—必要なものを作成してください
```

---

## 関連リンク

- [Getting Started](getting-started.md)
- [テンプレート](../templates/)
